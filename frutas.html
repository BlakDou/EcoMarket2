<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EcoMarket - Frutas</title>
  <link rel="stylesheet" href="dise√±o.css" />
  <style>
    /* --- Estilos del header y men√∫ --- */
    #userActions {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      color: #4caf50;
    }
    #userActions button {
      background-color: #4caf50;
      border: none;
      color: white;
      padding: 5px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
    }
    #userActions button:hover {
      background-color: #388e3c;
    }

    /* --- Productos --- */
    .products-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .product-card {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .product-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .product-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
    }
    .product-card button {
      background-color: #4caf50;
      border: none;
      color: white;
      padding: 5px 10px;
      margin-top: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    .product-card button:hover {
      background-color: #388e3c;
    }

    /* --- Carrito --- */
    .cart {
      position: fixed;
      top: 60px;
      right: 20px;
      width: 350px;
      max-height: 80vh;
      overflow-y: auto;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      z-index: 1000;
      transition: transform 0.3s;
    }
    .cart.hidden {
      transform: translateX(400px);
    }
    .cart h2 {
      text-align: center;
      color: #4caf50;
    }
    #cartItems li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 5px;
      border-bottom: 1px solid #ddd;
    }
    #cartItems li img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 5px;
      margin-right: 5px;
    }
    .cart-item button {
      margin: 0 2px;
      padding: 2px 6px;
      background-color: #e53935;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .cart-item button:hover {
      background-color: #b71c1c;
    }
    #cartItems input[type="number"] {
      width: 40px;
      text-align: center;
      margin: 0 3px;
    }

    /* --- Contacto --- */
    .contact-section {
      padding: 20px;
    }
    .contact-section form {
      display: flex;
      flex-direction: column;
      max-width: 400px;
      margin: 0 auto;
    }
    .contact-section label {
      margin-top: 10px;
    }
    .contact-section input, .contact-section textarea {
      padding: 5px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .contact-section button {
      margin-top: 10px;
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
    }
    .contact-section button:hover {
      background-color: #388e3c;
    }
  </style>
</head>
<body>

<header>
  <nav class="navbar">
    <div class="logo">EcoMarket</div>
    <ul class="menu">
      <li><a href="verduras.html">Verduras</a></li>
      <li><a href="" class="active">Frutas</a></li>
      <li><a href="legumbres.html">Legumbres</a></li>
      <li><a href="#contacto">Contacto</a></li>
      <li><a href="frutas.html">Frutas</a></li>

    </ul>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Buscar producto..." />
      <button id="searchBtn">Buscar</button>
    </div>
    <div id="userActions"></div>
    <button id="cartBtn" title="Ver carrito">üõí <span id="cartCount">0</span></button>
  </nav>
</header>

<main>
  <section id="products" class="products-container"></section>
</main>

<aside id="cart" class="cart hidden">
  <h2>Tu carrito</h2>
  <ul id="cartItems"></ul>
  <p>Total: S/ <span id="cartTotal">0.00</span></p>
  <button id="checkoutBtn">Pagar</button>
  <button id="closeCartBtn">Cerrar</button>
</aside>

<section id="contacto" class="contact-section">
  <h2>Contacto</h2>
  <form id="contactForm">
    <label for="name">Nombre:</label>
    <input type="text" name="name" id="name" required />

    <label for="email">Correo electr√≥nico:</label>
    <input type="email" name="email" id="email" required />

    <label for="message">Mensaje:</label>
    <textarea name="message" id="message" rows="4" required></textarea>

    <button type="submit">Enviar</button>
  </form>
  <div id="contactMessage" style="color: green; font-weight: bold; margin-top: 10px;"></div>
</section>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js"></script>
<script>
(function(){
  emailjs.init("mAvnLhYQa8v8sXiC_"); // TU PUBLIC KEY
})();
document.getElementById("contactForm").addEventListener("submit", function(event){
  event.preventDefault();
  emailjs.sendForm("service_yfzhxv9","template_bzcve6b",this)
    .then(() => {
      document.getElementById("contactMessage").textContent = "‚úÖ Se ha enviado el mensaje correctamente.";
      document.getElementById("contactForm").reset();
    }, (err) => {
      document.getElementById("contactMessage").textContent = "‚ùå Error al enviar: " + JSON.stringify(err);
    });
});
</script>

<script>
const userActions = document.getElementById('userActions');
const productsContainer = document.getElementById('products');
const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');
const cartBtn = document.getElementById('cartBtn');
const cart = document.getElementById('cart');
const cartItemsContainer = document.getElementById('cartItems');
const cartTotalSpan = document.getElementById('cartTotal');
const closeCartBtn = document.getElementById('closeCartBtn');
const checkoutBtn = document.getElementById('checkoutBtn');

let usuarioActivo = JSON.parse(localStorage.getItem('usuarioActivo'));
let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

const products = [
  { id: 101, nombre: "Aguaymanto", categoria: "frutas", precio: 5.00, imagen: "imagenes_frutas/aguaymanto.jpeg" },
  { id: 102, nombre: "L√∫cuma", categoria: "frutas", precio: 4.50, imagen: "imagenes_frutas/lucuma.jpg" },
  { id: 103, nombre: "Mango", categoria: "frutas", precio: 4.00, imagen: "imagenes_frutas/mango.jpeg" },
  { id: 104, nombre: "Maracuy√°", categoria: "frutas", precio: 4.20, imagen: "imagenes_frutas/maracuya.jpeg" },
];

// Mostrar productos
function mostrarProductos(){
  let lista = products;
  const query = searchInput.value.trim().toLowerCase();
  if(query !== '') lista = lista.filter(p => p.nombre.toLowerCase().includes(query));
  productsContainer.innerHTML = '';
  if(lista.length === 0){
    productsContainer.innerHTML = '<p>No hay productos que coincidan.</p>';
    return;
  }
  lista.forEach(prod=>{
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
      <img src="${prod.imagen}" alt="${prod.nombre}" />
      <div class="product-info">
        <h3>${prod.nombre}</h3>
        <p>S/ ${prod.precio.toFixed(2)} por kg</p>
        <input type="number" min="1" value="1" />
        <button>Agregar al carrito</button>
      </div>
    `;
    card.querySelector('button').addEventListener('click',()=>{
      const cantidad = parseInt(card.querySelector('input').value);
      if(cantidad>0) agregarAlCarrito(prod,cantidad);
      else alert('Ingrese una cantidad v√°lida.');
    });
    productsContainer.appendChild(card);
  });
}

// Agregar productos al carrito
function agregarAlCarrito(prod,cantidad){
  const idx = carrito.findIndex(item => item.id===prod.id);
  if(idx!==-1) carrito[idx].cantidad += cantidad;
  else carrito.push({...prod,cantidad});
  localStorage.setItem('carrito', JSON.stringify(carrito));
  actualizarCarritoUI();
  alert(`${prod.nombre} agregado al carrito.`);
}

// Actualizar carrito (din√°mico)
function actualizarCarritoUI(){
  cartItemsContainer.innerHTML = '';
  let total = 0;
  if(carrito.length===0){
    cartItemsContainer.innerHTML = '<li>Carrito vac√≠o</li>';
  } else {
    carrito.forEach((item,index)=>{
      total += item.precio * item.cantidad;
      const li = document.createElement('li');
      li.className = 'cart-item';
      li.innerHTML = `
        <img src="${item.imagen}" alt="${item.nombre}">
        <strong>${item.nombre}</strong>
        <span>S/ ${item.precio.toFixed(2)}</span>
        <button class="minusBtn" data-index="${index}">-</button>
        <input type="number" min="1" value="${item.cantidad}" data-index="${index}">
        <button class="plusBtn" data-index="${index}">+</button>
        <span>= S/ ${(item.precio*item.cantidad).toFixed(2)}</span>
        <button class="removeBtn" data-index="${index}">Eliminar</button>
      `;
      cartItemsContainer.appendChild(li);
    });

    // Inputs cantidad
    cartItemsContainer.querySelectorAll('input[type="number"]').forEach(input=>{
      input.addEventListener('change', e=>{
        const idx = e.target.dataset.index;
        let val = parseInt(e.target.value);
        if(val<1) val=1;
        carrito[idx].cantidad = val;
        localStorage.setItem('carrito', JSON.stringify(carrito));
        actualizarCarritoUI();
      });
    });

    // Botones + y -
    cartItemsContainer.querySelectorAll('.plusBtn').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const idx = e.target.dataset.index;
        carrito[idx].cantidad++;
        localStorage.setItem('carrito', JSON.stringify(carrito));
        actualizarCarritoUI();
      });
    });
    cartItemsContainer.querySelectorAll('.minusBtn').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const idx = e.target.dataset.index;
        if(carrito[idx].cantidad>1){
          carrito[idx].cantidad--;
          localStorage.setItem('carrito', JSON.stringify(carrito));
          actualizarCarritoUI();
        }
      });
    });

    // Botones eliminar
    cartItemsContainer.querySelectorAll('.removeBtn').forEach(btn=>{
      btn.addEventListener('click', e=>{
        const idx = e.target.dataset.index;
        carrito.splice(idx,1);
        localStorage.setItem('carrito', JSON.stringify(carrito));
        actualizarCarritoUI();
      });
    });
  }

  cartTotalSpan.textContent = total.toFixed(2);
  document.getElementById('cartCount').textContent = carrito.reduce((acc,it)=>acc+it.cantidad,0);
}

// Eventos carrito
cartBtn.addEventListener('click',()=>{cart.classList.toggle('hidden');});
closeCartBtn.addEventListener('click',()=>{cart.classList.add('hidden');});
checkoutBtn.addEventListener('click',()=>{
  if(carrito.length===0){ alert("El carrito est√° vac√≠o."); return; }
  alert('Gracias por tu compra (simulado).');
  carrito=[];
  actualizarCarritoUI();
  localStorage.removeItem('carrito');
  cart.classList.add('hidden');
});

// Login/Registro usuario
function mostrarOpcionesUsuario(){
  if(usuarioActivo){
    userActions.innerHTML = `<span>Hola, ${usuarioActivo.nombre}</span>
      <button id="logoutBtn">Cerrar sesi√≥n</button>`;
    document.getElementById('logoutBtn').addEventListener('click',()=>{
      localStorage.removeItem('usuarioActivo');
      usuarioActivo=null;
      mostrarOpcionesUsuario();
    });
  } else {
    userActions.innerHTML = `<button id="loginBtn">Login</button>
      <button id="registerBtn">Registro</button>`;
    document.getElementById('loginBtn').addEventListener('click',()=>{
      const nombre = prompt('Ingresa tu nombre para login:');
      if(nombre){
        usuarioActivo={nombre};
        localStorage.setItem('usuarioActivo',JSON.stringify(usuarioActivo));
        mostrarOpcionesUsuario();
      }
    });
    document.getElementById('registerBtn').addEventListener('click',()=>{
      const nombre = prompt('Ingresa tu nombre para registro:');
      if(nombre){
        usuarioActivo={nombre};
        localStorage.setItem('usuarioActivo',JSON.stringify(usuarioActivo));
        mostrarOpcionesUsuario();
      }
    });
  }
}

// B√∫squeda de productos
searchBtn.addEventListener('click',mostrarProductos);
searchInput.addEventListener('keydown', e=>{
  if(e.key==='Enter'){ e.preventDefault(); mostrarProductos(); }
});

// Inicializaci√≥n
mostrarOpcionesUsuario();
mostrarProductos();
actualizarCarritoUI();
</script>

</body>
</html>
